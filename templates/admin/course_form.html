{% extends "base.html" %}

{% block title %}{{ 'Edit Course' if course else 'Add Course' }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-100">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white shadow-sm rounded-lg overflow-hidden">
            <!-- Header -->
            <div class="px-4 py-5 border-b border-gray-200 sm:px-6">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold text-gray-900">
                        {{ 'Edit Course' if course else 'Add New Course' }}
                    </h1>
                    <div class="text-sm text-gray-500">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                            STEAM Focused
                        </span>
                    </div>
                </div>
            </div>

            <!-- Form -->
            <div class="px-4 py-5 sm:p-6">
                <form method="POST" class="space-y-6" id="courseForm">
                    <!-- Course Category -->
                    <div class="animated-form-group">
                        <label for="category" class="block text-sm font-medium text-gray-700">
                            Course Category (Required)
                        </label>
                        <div class="mt-1">
                            <select id="category" name="category" required 
                                    class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md transition-all duration-200">
                                <option value="">Select a category...</option>
                                <optgroup label="Science">
                                    <option value="biology">Biology</option>
                                    <option value="chemistry">Chemistry</option>
                                    <option value="physics">Physics</option>
                                    <option value="astronomy">Astronomy</option>
                                    <option value="environmental">Environmental Science</option>
                                </optgroup>
                                <optgroup label="Technology">
                                    <option value="programming">Programming</option>
                                    <option value="web_development">Web Development</option>
                                    <option value="mobile_apps">Mobile App Development</option>
                                    <option value="ai_ml">AI & Machine Learning</option>
                                    <option value="cybersecurity">Cybersecurity</option>
                                </optgroup>
                                <optgroup label="Engineering">
                                    <option value="mechanical">Mechanical Engineering</option>
                                    <option value="electrical">Electrical Engineering</option>
                                    <option value="civil">Civil Engineering</option>
                                    <option value="chemical">Chemical Engineering</option>
                                    <option value="aerospace">Aerospace Engineering</option>
                                </optgroup>
                                <optgroup label="Arts">
                                    <option value="digital_art">Digital Art & Design</option>
                                    <option value="animation">Animation</option>
                                    <option value="graphic_design">Graphic Design</option>
                                    <option value="game_design">Game Design</option>
                                    <option value="music_production">Music Production</option>
                                </optgroup>
                                <optgroup label="Mathematics">
                                    <option value="algebra">Algebra</option>
                                    <option value="calculus">Calculus</option>
                                    <option value="statistics">Statistics</option>
                                    <option value="geometry">Geometry</option>
                                    <option value="discrete_math">Discrete Mathematics</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>

                    <!-- Course Title -->
                    <div class="animated-form-group">
                        <label for="title" class="block text-sm font-medium text-gray-700">
                            Course Title (Required)
                        </label>
                        <div class="mt-1">
                            <input type="text" 
                                   name="title" 
                                   id="title" 
                                   required
                                   placeholder="e.g., 'Introduction to AI Programming'"
                                   value="{{ course.title if course else '' }}"
                                   class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md transition-all duration-200">
                        </div>
                        <p class="mt-1 text-sm text-gray-500">
                            Make it clear and descriptive
                        </p>
                    </div>

                    <!-- Course Description -->
                    <div class="animated-form-group">
                        <label for="description" class="block text-sm font-medium text-gray-700">
                            Course Description (Required)
                        </label>
                        <div class="mt-1">
                            <textarea name="description" 
                                      id="description" 
                                      rows="4" 
                                      required
                                      placeholder="Provide a detailed description of the course content, learning objectives, and prerequisites."
                                      class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md transition-all duration-200">{{ course.description if course else '' }}</textarea>
                        </div>
                        <p class="mt-1 text-sm text-gray-500">
                            Include learning objectives, prerequisites, and target audience
                        </p>
                    </div>

                    <!-- Level -->
                    <div class="animated-form-group">
                        <label for="level" class="block text-sm font-medium text-gray-700">
                            Course Level (Required)
                        </label>
                        <div class="mt-1">
                            <select id="level" name="level" required 
                                    class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md transition-all duration-200">
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>
                    </div>

                    <!-- Tags -->
                    <div class="animated-form-group">
                        <label for="tags" class="block text-sm font-medium text-gray-700">
                            Tags (Required - Use STEAM-related tags)
                        </label>
                        <div class="mt-1">
                            <input type="text" 
                                   name="tags" 
                                   id="tags" 
                                   required
                                   value="{{ course.semantic_tags if course else '' }}"
                                   placeholder="e.g., programming,python,algorithms,web development,ai"
                                   class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md transition-all duration-200">
                        </div>
                        <p class="mt-1 text-sm text-gray-500">
                            Add relevant STEAM tags to make your course searchable (e.g., programming, physics, design, calculus)
                        </p>
                    </div>

                    <!-- Course Details -->
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                        <!-- Max Students -->
                        <div class="animated-form-group">
                            <label for="max_students" class="block text-sm font-medium text-gray-700">
                                Maximum Students (Required)
                            </label>
                            <div class="mt-1">
                                <input type="number" 
                                       name="max_students" 
                                       id="max_students" 
                                       required
                                       min="1"
                                       max="100"
                                       value="{{ course.max_students if course else '50' }}"
                                       class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md transition-all duration-200">
                            </div>
                            <p class="mt-1 text-sm text-gray-500">
                                Maximum number of students (1-100)
                            </p>
                        </div>

                        <!-- Duration -->
                        <div class="animated-form-group">
                            <label for="duration_weeks" class="block text-sm font-medium text-gray-700">
                                Duration (Required)
                            </label>
                            <div class="mt-1">
                                <input type="number" 
                                       name="duration_weeks" 
                                       id="duration_weeks" 
                                       required
                                       min="1"
                                       max="24"
                                       value="{{ course.duration_weeks if course else '12' }}"
                                       class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md transition-all duration-200">
                            </div>
                            <p class="mt-1 text-sm text-gray-500">
                                Course duration in weeks (1-24)
                            </p>
                        </div>
                    </div>

                    <!-- Prerequisites -->
                    <div class="animated-form-group">
                        <label for="prerequisites" class="block text-sm font-medium text-gray-700">
                            Prerequisites (Optional)
                        </label>
                        <div class="mt-1">
                            <textarea name="prerequisites" 
                                      id="prerequisites" 
                                      rows="3"
                                      placeholder="List any prerequisites or recommended knowledge for this course"
                                      class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md transition-all duration-200">{{ course.prerequisites if course else '' }}</textarea>
                        </div>
                        <p class="mt-1 text-sm text-gray-500">
                            List any prerequisites or recommended knowledge
                        </p>
                    </div>

                    <!-- Actions -->
                    <div class="flex justify-end space-x-3">
                        <a href="{{ url_for('admin_dashboard') }}"
                           class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200">
                            Cancel
                        </a>
                        <button type="submit"
                                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200">
                            {{ 'Save Changes' if course else 'Create Course' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Add smooth transitions for form fields
    const formGroups = document.querySelectorAll('.animated-form-group');
    formGroups.forEach(group => {
        group.style.opacity = '0';
        group.style.transform = 'translateY(20px)';
        
        // Staggered animations
        setTimeout(() => {
            group.style.opacity = '1';
            group.style.transform = 'translateY(0)';
            group.style.transition = 'all 0.3s ease';
        }, 100 * Array.from(formGroups).indexOf(group));
    });

    // Enhance tag input with STEAM suggestions
    const tagsInput = document.getElementById('tags');
    const steamTags = [
        'programming', 'python', 'javascript', 'java', 'c++', 'data_structures', 'algorithms',
        'machine_learning', 'ai', 'neural_networks', 'deep_learning', 'cybersecurity', 'networking',
        'database', 'sql', 'web_development', 'frontend', 'backend', 'full_stack',
        'mobile_apps', 'android', 'ios', 'game_development', 'unity', 'unreal',
        'digital_art', 'graphic_design', 'animation', '3d_modeling', 'music_production',
        'mathematics', 'algebra', 'calculus', 'statistics', 'geometry',
        'physics', 'chemistry', 'biology', 'astronomy', 'environmental_science',
        'mechanical_engineering', 'electrical_engineering', 'civil_engineering', 'chemical_engineering', 'aerospace_engineering'
    ];

    tagsInput.addEventListener('input', function() {
        this.value = this.value.toLowerCase()
            .replace(/\s*,\s*/g, ',')  // Normalize spaces around commas
            .replace(/,+/g, ',')       // Remove multiple commas
            .replace(/^,|,$/g, '');    // Remove leading/trailing commas

        // Suggest tags if input is empty
        if (this.value.trim() === '') {
            const suggestions = steamTags.join(', ');
            this.setAttribute('placeholder', `Suggested tags: ${suggestions}`);
        } else {
            this.removeAttribute('placeholder');
        }
    });

    // Add keyboard navigation
    tagsInput.addEventListener('keydown', function(e) {
        if (e.key === ' ' || e.key === 'Enter') {
            e.preventDefault();
            if (!this.value.endsWith(',') && this.value.length > 0) {
                this.value += ',';
            }
        }
    });

    // Form validation
    const form = document.getElementById('courseForm');
    form.addEventListener('submit', function(e) {
        const title = document.getElementById('title').value.trim();
        const description = document.getElementById('description').value.trim();
        const category = document.getElementById('category').value;
        const level = document.getElementById('level').value;
        const tags = document.getElementById('tags').value.trim();
        const maxStudents = document.getElementById('max_students').value;
        const duration = document.getElementById('duration_weeks').value;

        if (!title || !description || !category || !level || !tags || !maxStudents || !duration) {
            e.preventDefault();
            alert('Please fill in all required fields');
            return;
        }

        // Validate max_students range
        if (parseInt(maxStudents) < 1 || parseInt(maxStudents) > 100) {
            e.preventDefault();
            alert('Maximum students must be between 1 and 100');
            return;
        }

        // Validate duration range
        if (parseInt(duration) < 1 || parseInt(duration) > 24) {
            e.preventDefault();
            alert('Course duration must be between 1 and 24 weeks');
            return;
        }

        // Validate tags
        const tagList = tags.split(',').map(tag => tag.trim());
        if (tagList.length === 0) {
            e.preventDefault();
            alert('Please add at least one tag');
            return;
        }

        // Check if tags are STEAM-related
        const nonSteamTags = tagList.filter(tag => !steamTags.includes(tag));
        if (nonSteamTags.length > 0) {
            if (!confirm(`Warning: Some tags are not STEAM-related: ${nonSteamTags.join(', ')}. Continue anyway?`)) {
                e.preventDefault();
                return;
            }
        }
    });
</script>
{% endblock %}
